<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>å°çŒ«é’“é±¼ - æ‰‘å…‹ç‰Œæ¸¸æˆ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            user-select: none;
        }

        body {
            font-family: 'Microsoft YaHei', sans-serif;
            background: linear-gradient(135deg, #1a5f2a 0%, #2d8f4a 50%, #1a5f2a 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 10px;
            overflow: hidden;
        }

        .game-container {
            width: 100%;
            max-width: 600px;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        /* æ ‡é¢˜ */
        .title {
            text-align: center;
            color: #ffd700;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            font-size: clamp(24px, 5vw, 36px);
            font-weight: bold;
            letter-spacing: 4px;
        }

        .title::before, .title::after {
            content: 'ğŸŸ';
            margin: 0 10px;
        }

        /* ä¿¡æ¯æ  */
        .info-bar {
            display: flex;
            justify-content: space-between;
            background: rgba(0,0,0,0.3);
            border-radius: 10px;
            padding: 10px 20px;
            color: white;
        }

        .player-info {
            text-align: center;
        }

        .player-info.computer {
            color: #ff6b6b;
        }

        .player-info.player {
            color: #4ecdc4;
        }

        .player-name {
            font-size: 14px;
            opacity: 0.8;
        }

        .card-count {
            font-size: 24px;
            font-weight: bold;
        }

        /* æ¸¸æˆåŒºåŸŸ */
        .game-area {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
            padding: 20px;
            background: rgba(0,0,0,0.2);
            border-radius: 15px;
            min-height: 300px;
        }

        /* ç‰Œå †åŒº */
        .card-area {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            flex-wrap: wrap;
        }

        .deck {
            position: relative;
            width: 70px;
            height: 100px;
        }

        .deck-stack {
            position: absolute;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #2563eb, #1d4ed8);
            border-radius: 8px;
            box-shadow: 2px 2px 5px rgba(0,0,0,0.3);
        }

        .deck-stack:nth-child(2) { transform: translate(2px, 2px); }
        .deck-stack:nth-child(3) { transform: translate(4px, 4px); }

        .deck-back {
            position: absolute;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #2563eb, #1d4ed8);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 24px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
            border: 2px solid #3b82f6;
        }

        .deck-count {
            position: absolute;
            bottom: -25px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.6);
            color: white;
            padding: 2px 10px;
            border-radius: 10px;
            font-size: 12px;
        }

        /* å…¬å…±ç‰Œå † */
        .pile-area {
            min-width: 200px;
            min-height: 120px;
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            border: 2px dashed rgba(255,255,255,0.3);
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            align-items: center;
            padding: 10px;
            gap: 5px;
        }

        .pile-area::before {
            content: 'å…¬å…±ç‰Œå †';
            position: absolute;
            color: rgba(255,255,255,0.3);
            font-size: 12px;
        }

        .pile-label {
            width: 100%;
            text-align: center;
            color: rgba(255,255,255,0.5);
            font-size: 12px;
            margin-bottom: 5px;
        }

        /* æ‰‘å…‹ç‰Œ */
        .card {
            width: 50px;
            height: 70px;
            background: white;
            border-radius: 5px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
            transition: transform 0.3s ease;
            position: relative;
            cursor: default;
        }

        .card.red { color: #dc2626; }
        .card.black { color: #1f2937; }

        .card-rank {
            font-size: 18px;
            line-height: 1;
        }

        .card-suit {
            font-size: 16px;
            line-height: 1;
        }

        .card.highlight {
            animation: pulse 0.5s ease infinite;
            box-shadow: 0 0 15px #ffd700;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .card.new-card {
            animation: dealCard 0.3s ease;
        }

        @keyframes dealCard {
            from {
                transform: translateY(-50px) rotate(-10deg);
                opacity: 0;
            }
            to {
                transform: translateY(0) rotate(0);
                opacity: 1;
            }
        }

        .card.collect-card {
            animation: collectCard 0.5s ease forwards;
        }

        @keyframes collectCard {
            to {
                transform: scale(0) rotate(180deg);
                opacity: 0;
            }
        }

        /* ç©å®¶åŒºåŸŸ */
        .player-area {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
        }

        .player-deck {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
        }

        .player-deck-label {
            color: white;
            font-size: 12px;
            opacity: 0.8;
        }

        /* æŒ‰é’® */
        .btn {
            padding: 12px 30px;
            font-size: 18px;
            font-weight: bold;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .btn-play {
            background: linear-gradient(135deg, #f59e0b, #d97706);
            color: white;
            box-shadow: 0 4px 15px rgba(245, 158, 11, 0.4);
        }

        .btn-play:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(245, 158, 11, 0.6);
        }

        .btn-play:active:not(:disabled) {
            transform: translateY(0);
        }

        .btn-play:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn-restart {
            background: linear-gradient(135deg, #6366f1, #4f46e5);
            color: white;
            padding: 8px 20px;
            font-size: 14px;
        }

        .btn-restart:hover {
            transform: scale(1.05);
        }

        /* æ¶ˆæ¯ */
        .message {
            text-align: center;
            color: #ffd700;
            font-size: 16px;
            min-height: 24px;
            font-weight: bold;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
        }

        .message.success {
            animation: bounce 0.5s ease;
        }

        @keyframes bounce {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.2); }
        }

        /* æ¸¸æˆç»“æŸé®ç½© */
        .game-over {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 100;
        }

        .game-over.show {
            display: flex;
        }

        .game-over-content {
            text-align: center;
            color: white;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.8); }
            to { opacity: 1; transform: scale(1); }
        }

        .game-over-title {
            font-size: 48px;
            margin-bottom: 20px;
        }

        .game-over-title.win { color: #ffd700; }
        .game-over-title.lose { color: #ff6b6b; }

        .game-over-text {
            font-size: 24px;
            margin-bottom: 30px;
        }

        /* è§„åˆ™æç¤º */
        .rules {
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            padding: 15px;
            color: rgba(255,255,255,0.8);
            font-size: 12px;
            line-height: 1.6;
        }

        .rules-title {
            color: #ffd700;
            font-weight: bold;
            margin-bottom: 8px;
        }

        /* å“åº”å¼ */
        @media (max-width: 400px) {
            .card {
                width: 40px;
                height: 56px;
            }
            .card-rank { font-size: 14px; }
            .card-suit { font-size: 12px; }
            .deck { width: 55px; height: 78px; }
            .pile-area { min-height: 100px; }
        }

        /* è‡ªåŠ¨è¿›è¡ŒæŒ‡ç¤º */
        .auto-indicator {
            position: fixed;
            top: 10px;
            right: 10px;
            background: rgba(0,0,0,0.7);
            color: #4ecdc4;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 12px;
            display: none;
        }

        .auto-indicator.show {
            display: block;
            animation: blink 1s ease infinite;
        }

        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
    </style>
</head>
<body>
    <div class="auto-indicator" id="autoIndicator">ç”µè„‘æ€è€ƒä¸­...</div>

    <div class="game-container">
        <h1 class="title">å°çŒ«é’“é±¼</h1>

        <div class="info-bar">
            <div class="player-info computer">
                <div class="player-name">ğŸ± ç”µè„‘</div>
                <div class="card-count" id="computerCount">26</div>
            </div>
            <div class="player-info">
                <div class="player-name">å›åˆ</div>
                <div class="card-count" id="turnCount">1</div>
            </div>
            <div class="player-info player">
                <div class="player-name">ğŸ‘¤ ç©å®¶</div>
                <div class="card-count" id="playerCount">26</div>
            </div>
        </div>

        <div class="game-area">
            <div class="player-area">
                <div class="player-deck">
                    <div class="deck">
                        <div class="deck-stack"></div>
                        <div class="deck-stack"></div>
                        <div class="deck-stack"></div>
                        <div class="deck-back">ğŸ±</div>
                    </div>
                    <span class="deck-count" id="computerDeckCount">26å¼ </span>
                </div>

                <div class="pile-area" id="pileArea">
                    <div class="pile-label">å…¬å…±ç‰Œå †</div>
                </div>

                <div class="player-deck">
                    <div class="deck">
                        <div class="deck-stack"></div>
                        <div class="deck-stack"></div>
                        <div class="deck-stack"></div>
                        <div class="deck-back">ğŸ‘¤</div>
                    </div>
                    <span class="deck-count" id="playerDeckCount">26å¼ </span>
                </div>
            </div>

            <div class="message" id="message">ç‚¹å‡»"å‡ºç‰Œ"å¼€å§‹æ¸¸æˆï¼</div>

            <div style="display: flex; gap: 10px;">
                <button class="btn btn-play" id="playBtn" onclick="playerPlay()">å‡º ç‰Œ</button>
                <button class="btn btn-restart" onclick="initGame()">é‡æ–°å¼€å§‹</button>
            </div>
        </div>

        <div class="rules">
            <div class="rules-title">ğŸ“œ æ¸¸æˆè§„åˆ™</div>
            è½®æµå‡ºç‰Œåˆ°å…¬å…±ç‰Œå †ï¼Œå½“å‡ºçš„ç‰Œä¸ç‰Œå †ä¸­æŸå¼ ç‰Œ<b>ç‚¹æ•°ç›¸åŒ</b>æ—¶ï¼Œæ”¶èµ°ä¸¤å¼ ç›¸åŒç‰Œä¹‹é—´çš„æ‰€æœ‰ç‰Œã€‚å…ˆå‡ºå®Œç‰Œçš„ä¸€æ–¹è¾“æ‰æ¸¸æˆï¼
        </div>
    </div>

    <div class="game-over" id="gameOver">
        <div class="game-over-content">
            <div class="game-over-title" id="gameOverTitle">ğŸ‰ èƒœåˆ©ï¼</div>
            <div class="game-over-text" id="gameOverText">æ­å–œä½ èµ¢å¾—äº†æ¯”èµ›ï¼</div>
            <button class="btn btn-play" onclick="initGame()">å†æ¥ä¸€å±€</button>
        </div>
    </div>

    <script>
        // èŠ±è‰²å®šä¹‰
        const SUITS = ['â™ ', 'â™¥', 'â™¦', 'â™£'];
        const SUIT_COLORS = {'â™ ': 'black', 'â™¥': 'red', 'â™¦': 'red', 'â™£': 'black'};
        const RANKS = ['A', '2', '3', '4', '5', '6', '7', '8', '9', '10', 'J', 'Q', 'K'];

        // æ¸¸æˆçŠ¶æ€
        let playerDeck = [];
        let computerDeck = [];
        let pile = [];
        let isPlayerTurn = true;
        let gameOver = false;
        let turnCount = 1;
        let isAnimating = false;

        // åˆ›å»ºä¸€å‰¯ç‰Œ
        function createDeck() {
            const deck = [];
            for (let suit of SUITS) {
                for (let i = 0; i < RANKS.length; i++) {
                    deck.push({
                        suit: suit,
                        rank: RANKS[i],
                        value: i + 1,
                        color: SUIT_COLORS[suit]
                    });
                }
            }
            return deck;
        }

        // æ´—ç‰Œ
        function shuffle(deck) {
            for (let i = deck.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [deck[i], deck[j]] = [deck[j], deck[i]];
            }
            return deck;
        }

        // åˆå§‹åŒ–æ¸¸æˆ
        function initGame() {
            const deck = shuffle(createDeck());
            playerDeck = deck.slice(0, 26);
            computerDeck = deck.slice(26);
            pile = [];
            isPlayerTurn = true;
            gameOver = false;
            turnCount = 1;
            isAnimating = false;

            updateUI();
            updatePileDisplay();
            document.getElementById('gameOver').classList.remove('show');
            document.getElementById('autoIndicator').classList.remove('show');
            document.getElementById('playBtn').disabled = false;
            showMessage('ç‚¹å‡»"å‡ºç‰Œ"å¼€å§‹æ¸¸æˆï¼');
        }

        // åˆ›å»ºå¡ç‰Œå…ƒç´ 
        function createCardElement(card, isNew = false) {
            const div = document.createElement('div');
            div.className = `card ${card.color}${isNew ? ' new-card' : ''}`;
            div.innerHTML = `
                <span class="card-rank">${card.rank}</span>
                <span class="card-suit">${card.suit}</span>
            `;
            div.dataset.value = card.value;
            return div;
        }

        // æ›´æ–°UI
        function updateUI() {
            document.getElementById('playerCount').textContent = playerDeck.length;
            document.getElementById('computerCount').textContent = computerDeck.length;
            document.getElementById('playerDeckCount').textContent = playerDeck.length + 'å¼ ';
            document.getElementById('computerDeckCount').textContent = computerDeck.length + 'å¼ ';
            document.getElementById('turnCount').textContent = turnCount;
        }

        // æ›´æ–°å…¬å…±ç‰Œå †æ˜¾ç¤º
        function updatePileDisplay() {
            const pileArea = document.getElementById('pileArea');
            pileArea.innerHTML = '<div class="pile-label">å…¬å…±ç‰Œå †</div>';

            // åªæ˜¾ç¤ºæœ€åå‡ å¼ ç‰Œ
            const showCount = Math.min(pile.length, 8);
            const startIndex = Math.max(0, pile.length - showCount);

            for (let i = startIndex; i < pile.length; i++) {
                const cardEl = createCardElement(pile[i]);
                if (i === pile.length - 1) {
                    cardEl.classList.add('new-card');
                }
                pileArea.appendChild(cardEl);
            }
        }

        // æ˜¾ç¤ºæ¶ˆæ¯
        function showMessage(msg, isSuccess = false) {
            const msgEl = document.getElementById('message');
            msgEl.textContent = msg;
            msgEl.className = 'message' + (isSuccess ? ' success' : '');
        }

        // ç©å®¶å‡ºç‰Œ
        function playerPlay() {
            if (gameOver || !isPlayerTurn || isAnimating || playerDeck.length === 0) return;

            isAnimating = true;
            document.getElementById('playBtn').disabled = true;

            const card = playerDeck.shift();
            pile.push(card);
            updatePileDisplay();
            updateUI();

            // æ£€æŸ¥æ˜¯å¦æ”¶ç‰Œ
            setTimeout(() => {
                const collectResult = checkCollect(card, playerDeck);

                if (collectResult.collected) {
                    animateCollect(collectResult.indices, () => {
                        playerDeck = collectResult.newDeck;
                        pile = collectResult.newPile;
                        updateUI();
                        updatePileDisplay();
                        showMessage(`ğŸ‰ æ”¶åˆ° ${collectResult.count} å¼ ç‰Œï¼`, true);
                        checkGameOver();

                        if (!gameOver) {
                            isPlayerTurn = false;
                            setTimeout(computerPlay, 800);
                        } else {
                            isAnimating = false;
                        }
                    });
                } else {
                    showMessage('');
                    isPlayerTurn = false;
                    turnCount++;
                    setTimeout(computerPlay, 800);
                }
            }, 300);
        }

        // ç”µè„‘å‡ºç‰Œ
        function computerPlay() {
            if (gameOver || computerDeck.length === 0) {
                isAnimating = false;
                document.getElementById('playBtn').disabled = false;
                return;
            }

            document.getElementById('autoIndicator').classList.add('show');

            setTimeout(() => {
                document.getElementById('autoIndicator').classList.remove('show');

                const card = computerDeck.shift();
                pile.push(card);
                updatePileDisplay();
                updateUI();

                setTimeout(() => {
                    const collectResult = checkCollect(card, computerDeck);

                    if (collectResult.collected) {
                        animateCollect(collectResult.indices, () => {
                            computerDeck = collectResult.newDeck;
                            pile = collectResult.newPile;
                            updateUI();
                            updatePileDisplay();
                            showMessage(`ğŸ± ç”µè„‘æ”¶åˆ° ${collectResult.count} å¼ ç‰Œï¼`, true);
                            checkGameOver();

                            if (!gameOver) {
                                isPlayerTurn = true;
                                turnCount++;
                                isAnimating = false;
                                document.getElementById('playBtn').disabled = false;
                            }
                        });
                    } else {
                        isPlayerTurn = true;
                        turnCount++;
                        isAnimating = false;
                        document.getElementById('playBtn').disabled = false;
                    }
                }, 300);
            }, 500);
        }

        // æ£€æŸ¥æ”¶ç‰Œ
        function checkCollect(card, deck) {
            const matchIndex = pile.slice(0, -1).findIndex(c => c.value === card.value);

            if (matchIndex !== -1) {
                // æ‰¾åˆ°åŒ¹é…ï¼Œæ”¶ç‰Œ
                const collectedCards = pile.slice(matchIndex);
                return {
                    collected: true,
                    indices: Array.from({length: pile.length - matchIndex}, (_, i) => matchIndex + i),
                    count: collectedCards.length,
                    newDeck: [...deck, ...collectedCards],
                    newPile: pile.slice(0, matchIndex)
                };
            }

            return { collected: false };
        }

        // æ”¶ç‰ŒåŠ¨ç”»
        function animateCollect(indices, callback) {
            const pileArea = document.getElementById('pileArea');
            const cards = pileArea.querySelectorAll('.card');

            indices.forEach((idx, i) => {
                const actualIdx = cards.length - pile.length + idx;
                if (cards[actualIdx]) {
                    setTimeout(() => {
                        cards[actualIdx].classList.add('collect-card');
                    }, i * 50);
                }
            });

            setTimeout(callback, indices.length * 50 + 500);
        }

        // æ£€æŸ¥æ¸¸æˆç»“æŸ
        function checkGameOver() {
            if (playerDeck.length === 0) {
                gameOver = true;
                showGameOver(false);
            } else if (computerDeck.length === 0) {
                gameOver = true;
                showGameOver(true);
            }
        }

        // æ˜¾ç¤ºæ¸¸æˆç»“æŸ
        function showGameOver(playerWin) {
            const overlay = document.getElementById('gameOver');
            const title = document.getElementById('gameOverTitle');
            const text = document.getElementById('gameOverText');

            if (playerWin) {
                title.textContent = 'ğŸ‰ èƒœåˆ©ï¼';
                title.className = 'game-over-title win';
                text.textContent = 'æ­å–œä½ èµ¢å¾—äº†æ¯”èµ›ï¼';
            } else {
                title.textContent = 'ğŸ˜¢ å¤±è´¥';
                title.className = 'game-over-title lose';
                text.textContent = 'ç”µè„‘èµ¢å¾—äº†æ¯”èµ›ï¼Œå†æ¥å†å‰ï¼';
            }

            overlay.classList.add('show');
            document.getElementById('playBtn').disabled = true;
        }

        // é”®ç›˜æ”¯æŒ
        document.addEventListener('keydown', (e) => {
            if (e.code === 'Space') {
                e.preventDefault();
                playerPlay();
            }
        });

        // åˆå§‹åŒ–
        initGame();
    </script>
</body>
</html>
