# 掼蛋 - 局域网版使用说明

## 📋 目录
1. [系统要求](#系统要求)
2. [安装步骤](#安装步骤)
3. [服务器设置](#服务器设置)
4. [客户端连接](#客户端连接)
5. [游戏规则](#游戏规则)
6. [游戏操作](#游戏操作)
7. [常见问题](#常见问题)

---

## 系统要求

### 服务器端
- Node.js 14.0 或更高版本
- 操作系统: Windows/Linux/MacOS
- 网络端口: 8081 (确保防火墙允许此端口)

### 客户端
- 现代浏览器 (Chrome/Firefox/Edge/Safari)
- 网络连接: 与服务器在同一局域网

---

## 安装步骤

### 1. 安装Node.js

访问 [Node.js官网](https://nodejs.org/) 下载并安装最新LTS版本。

验证安装:
```bash
node --version
```

### 2. 安装WebSocket库

在游戏目录打开命令行,运行:

```bash
npm install
```

或手动安装:
```bash
npm install ws
```

### 3. 准备游戏文件

确保以下文件在同一目录中:
- `guandan-server.js` - 服务器程序
- `guandan-lan.html` - 游戏客户端
- `package.json` - 项目配置

---

## 服务器设置

### 启动服务器

在游戏目录打开命令行,运行:

```bash
node guandan-server.js
```

### 成功启动的标志

看到以下信息表示服务器启动成功:

```
🃏 掼蛋局域网服务器运行在端口 8081
等待玩家连接...
```

### 查看服务器IP地址

**Windows:**
```bash
ipconfig
```
查找 "IPv4 地址" (例如: `10.80.4.72` 或 `192.168.1.100`)

**Linux/MacOS:**
```bash
ifconfig
```
或
```bash
ip addr show
```

---

## 客户端连接

### 方法一: 本机测试

1. 打开浏览器
2. 访问: `http://localhost:8081`
3. 输入名称，点击牌桌加入或创建新桌

### 方法二: 局域网连接

1. 确保服务器已启动
2. 在同一局域网的其他设备上打开浏览器
3. 访问: `http://[服务器IP]:8081`
   - 例如: `http://192.168.1.100:8081`
4. 输入名称，选择牌桌加入或创建新桌

> 💡 **提示**: 服务器启动后会显示本机IP地址，直接分享给其他玩家即可。

### 牌桌列表

登录后会显示所有牌桌：
- **空桌**: 点击即可加入
- **游戏中**: 显示蓝色边框，无法加入
- **已满**: 显示红色边框，无法加入
- **创建新桌**: 点击 "+" 卡片创建新牌桌

### 游戏流程

1. 输入名称
2. 点击牌桌加入 或 创建新桌
3. 等待4人齐后点击"准备"
4. 全部准备后游戏自动开始

---

## 游戏界面

### 桌面布局

游戏以圆桌形式显示，玩家位置如下：

```
        [3号位]
      红队 · 红队
           │
    ─────────────
           │
      蓝队 · 蓝队
        [1号位]
```

- **1号位**: 屏幕右侧（自己）
- **2号位**: 1号位逆时针方向
- **3号位**: 1号位对面
- **4号位**: 1号位顺时针方向

### 出牌顺序

按 **1 → 2 → 3 → 4** 逆时针顺序轮流出牌

### 队伍分配

- **红队**: 1号位 + 3号位（对家）
- **蓝队**: 2号位 + 4号位（对家）

---

## 游戏规则

### 基本信息
- **玩家人数**: 4人（2对搭档）
- **使用牌数**: 2副标准扑克牌（108张）
- **每人手牌**: 27张

### 牌面大小
```
大王 > 小王 > A > K > Q > J > 10 > 9 > 8 > 7 > 6 > 5 > 4 > 3 > 2
```
⚠️ 注意：2是最小的牌！

### 队伍分配

参见 [游戏界面 - 队伍分配](#队伍分配)

### 出牌规则
1. 按逆时针方向轮流出牌
2. 必须压过上家的牌才能出
3. 可以选择"不出"（过）
4. 同一轮中，所有人都"过"后，最后出牌的一方继续领出新牌

### 牌型说明

| 牌型  | 说明               |
| --- | ---------------- |
| 单张  | 任意一张牌            |
| 对子  | 两张相同的牌           |
| 三张  | 三张相同的牌           |
| 三带二 | 三张相同+一对          |
| 顺子  | 5张连续单牌（不含王）      |
| 连对  | 3对连续对子           |
| 飞机  | 2组连续三张           |
| 炸弹  | 4张或以上相同的牌        |
| 同花顺 | 5张同花色顺子          |
| 王炸  | 四张王（最大）          |

### 逢人配（百搭）
- 每局与当前级别相同点数的红桃牌为"逢人配"
- 可作为任意牌使用
- 例如：当前打3，红桃3可作为万能牌

### 升级规则
- **双下**: 搭档获得前两名 → 升3级
- **单下**: 搭档获得第一和第三 → 升2级
- **平局**: 其他情况 → 升1级

---

## 游戏操作

### 开始游戏

1. 4名玩家全部进入房间
2. 所有玩家点击 "准备" 按钮
3. 游戏自动开始

### 出牌操作

1. **选择牌**: 点击手牌选中/取消
2. **出牌**: 选好牌后点击"出牌"按钮
3. **不出**: 点击"不出"按钮跳过本轮
4. **清空选择**: 取消所有已选的牌

### 界面说明

- **当前级别**: 显示当前打的级别（2-A）
- **逢人配**: 显示当前万能牌
- **我的队伍**: 显示所属队伍
- **对手区域**: 显示对手的牌数和出牌
- **黄色边框**: 表示轮到该玩家出牌

### 聊天功能

- 在聊天框输入消息
- 按 `Enter` 发送

---

## 常见问题

### Q: 无法连接到服务器

**A: 检查以下项目:**
1. 确认服务器已启动 (`node guandan-server.js` 正在运行)
2. 确认IP地址和端口正确
3. 检查防火墙设置,允许8081端口
4. 确认客户端和服务器在同一局域网

### Q: 端口8081被占用

**A: 修改 `guandan-server.js` 中的端口号:**
```javascript
const PORT = 8082; // 改为其他端口
```

### Q: 游戏卡住不动

**A:**
1. 刷新浏览器页面重新连接
2. 检查网络连接状态
3. 重启服务器

### Q: 出牌提示"无效的牌型"

**A:**
- 检查选择的牌是否符合牌型规则
- 顺子、连对等需要连续的牌
- 炸弹需要4张以上相同的牌

### Q: 如何开始新一局

**A:**
- 一局结束后会显示结算界面
- 任意玩家点击"下一局"按钮即可开始

---

## 技术支持

如遇到问题,请检查:
1. Node.js版本是否正确
2. WebSocket库是否安装
3. 防火墙和网络设置
4. 浏览器控制台错误信息(F12打开开发者工具)

---

## 开发说明

> ⚠️ **重要提示**: 修改服务器代码 (`guandan-server.js`) 后，必须重启服务器才能生效！

### 重启服务器步骤

1. 找到并终止旧进程:
```bash
# Windows
netstat -ano | findstr :8081
# 找到PID后
taskkill /PID <PID> /F

# 或者直接用 PowerShell
Stop-Process -Name node -Force
```

2. 重新启动服务器:
```bash
node guandan-server.js
```

### AI 助手提示

在使用 AI 助手（如 Claude）修改代码时，请在需求中明确说明：
- "**修改完成后自动重启服务器**" - AI 会自动帮你重启
- "**不需要重启**" - 如果只是修改前端 HTML 文件

---

## 文件说明

```
掼蛋/
├── guandan-server.js    # WebSocket服务器
├── guandan-lan.html     # H5客户端游戏
├── package.json         # 项目配置
└── 局域网版使用说明.md   # 本说明文档
```

---

**版本:** v1.4
**更新日期:** 2026-03-02
**开发者:** AI Assistant

---

## 相关链接

- [[掼蛋]] - 掼蛋游戏规则文档
- [[坦克1999]] - 坦克大战局域网游戏
