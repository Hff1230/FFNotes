# 文档去黑影脚本使用说明

## 📁 文件信息

- **脚本名称**: `文档去黑影.jsx`
- **适用版本**: Adobe Photoshop CS6 及以上版本
- **脚本语言**: ExtendScript (JSX)
- **最新版本**: v1.0

---

## ✨ 功能亮点

### 🎯 专为文档拍摄设计

这个脚本专门用于处理拍摄或扫描的试卷、文件、书籍、合同等文档：

| 功能 | 说明 |
|------|------|
| ✅ **去除书本装订阴影** | 自动检测并消除书本中缝的黑影 |
| ✅ **去除边缘暗角** | 消除拍摄时的光照不均和边缘暗角 |
| ✅ **自动白平衡** | 让纸张呈现纯白色，去除偏色 |
| ✅ **文字清晰度增强** | 提升文字对比度和可读性 |
| ✅ **锐化文字边缘** | 让文字更加清晰锐利 |
| ✅ **去除噪点** | 消除扫描噪点和拍照颗粒 |
| ✅ **黑白转换** | 可选的纯黑白二值化输出 |

---

## 🚀 快速开始

### 方法一：直接运行（推荐）

1. **打开文档照片**
   ```
   在Photoshop中打开拍摄的文档照片
   ```

2. **运行脚本**
   ```
   文件 → 脚本 → 浏览 → 选择"文档去黑影.jsx"
   ```

3. **选择文档类型**
   - 试卷/单页文档
   - 书本（有装订阴影）
   - 杂志/画册
   - 手写笔记
   - 证件/合同

4. **配置选项**（建议全部勾选）
   - ✅ 自动白平衡
   - ✅ 去除黑影和暗角
   - ✅ 增强文字清晰度
   - ✅ 锐化文字边缘

5. **点击"开始处理"**

### 方法二：自动加载

将脚本复制到Photoshop脚本目录：

- **Windows**: `C:\Program Files\Adobe\Adobe Photoshop [版本]\Presets\Scripts\`
- **Mac**: `/Applications/Adobe Photoshop [版本]/Presets/Scripts/`

重启后，脚本将出现在 `文件 → 脚本` 菜单中。

---

## ⚙️ 功能详解

### 📋 文档类型

选择正确的文档类型可以获得最佳效果：

| 类型 | 适用场景 | 特殊处理 |
|------|---------|---------|
| **试卷/单页文档** | 试卷、A4纸、单页文件 | 标准去黑影流程 |
| **书本（有装订阴影）** | 教科书、杂志、厚本书 | 额外的装订线修复 |
| **杂志/画册** | 彩色杂志、画册、宣传册 | 保留色彩的同时去黑影 |
| **手写笔记** | 笔记、手稿、草稿 | 增强手写字迹 |
| **证件/合同** | 身份证、合同、证书 | 清晰度和锐化优先 |

### 🔧 处理选项

#### 1. 自动白平衡（纸张变白）
- **作用**：自动调整色阶，让纸张呈现纯白色
- **效果**：去除偏黄、偏蓝等色偏
- **适用**：所有文档照片
- **建议**：始终勾选

#### 2. 去除黑影和暗角
- **作用**：消除边缘暗角和书本装订处阴影
- **技术**：使用大半径模糊 + 叠加混合模式
- **效果**：文档整体亮度均匀
- **建议**：始终勾选

**书本类型特殊处理**：
- 创建额外的"装订线修复"层
- 专门针对中缝阴影

#### 3. 增强文字清晰度
- **作用**：提高文字对比度
- **技术**：USM锐化（数量150%，半径1.5）
- **效果**：文字更清晰易读
- **建议**：模糊照片必选

#### 4. 锐化文字边缘
- **作用**：强化文字轮廓
- **技术**：智能锐化 + 叠加混合模式
- **效果**：文字边缘更锐利
- **建议**：与"增强文字清晰度"配合使用

#### 5. 去除噪点（扫描痕迹）
- **作用**：消除扫描噪点和拍照颗粒
- **技术**：去斑滤镜 + 轻微高斯模糊
- **效果**：表面更平滑
- **适用**：扫描文档或高ISO拍摄的照片

#### 6. 自动裁剪边缘空白
- **作用**：自动去除文档周围的空白区域
- **技术**：基于白色的裁切
- **效果**：画面更紧凑
- **注意**：可能裁掉边缘内容，谨慎使用

#### 7. 转换为纯黑白（二值化）
- **作用**：将文档转为纯黑白
- **技术**：灰度 + 阈值调整（180）
- **效果**：只有黑色文字和白色背景
- **适用**：
  - 需要OCR文字识别
  - 需要打印
  - 需要减小文件大小
- **注意**：会丢失所有灰度信息

### 🎚️ 处理强度

| 强度 | 适用场景 | 效果描述 |
|------|---------|---------|
| **轻微** | 质量较好的照片 | 30-40%强度，自然效果 |
| **适中** | 大多数情况（推荐） | 100%标准强度 |
| **强力** | 严重黑影/暗角 | 140%强度，可能过度 |

**选择建议**：
- 光照均匀：轻微
- 有明显黑影：适中
- 严重阴影或暗角：强力

---

## 📸 拍摄技巧

### 最佳拍摄方法

获得最佳处理效果，需要先拍好照片：

#### 1. 光照条件
```
✅ 推荐：
  - 自然光（窗边，避免直射）
  - 柔和的室内灯光
  - 使用台灯从两侧打光

❌ 避免：
  - 强烈直射阳光（造成反光）
  - 单一方向强光（造成阴影）
  - 闪光灯（造成 glare）
```

#### 2. 拍摄角度
```
✅ 推荐：
  - 相机与文档平行（俯拍）
  - 使用三脚架或固定设备
  - 手机使用网格线辅助

❌ 避免：
  - 斜角拍摄（需要透视矫正）
  - 手持抖动
```

#### 3. 背景选择
```
✅ 推荐：
  - 纯色背景（黑布/白布）
  - 干净的桌面
  - 对比度高的背景

❌ 避免：
  - 杂乱背景
  - 与文档颜色相近的背景
```

#### 4. 书本拍摄技巧
```
对于厚本书籍：
  1. 用重物压平书页
  2. 从45度角拍摄，避免装订线过暗
  3. 可分两次拍摄左右页，再拼接
  4. 使用"书本（有装订阴影）"模式
```

---

## 💡 使用技巧

### 工作流建议

#### 标准流程
```
1. 拍摄文档（按照拍摄技巧）
2. 运行脚本
3. 检查效果
4. 手动微调（如有需要）
5. 导出保存
```

#### 专业流程（高质量）
```
1. 拍摄RAW格式（如支持）
2. Lightroom/Camera RAW预处理
3. 导出为TIFF/JPEG
4. 运行本脚本
5. 手动调整局部效果
6. 最终导出
```

### 图层调整

脚本运行后创建的图层：

```
📄 白平衡调整 - 自动白平衡效果
📄 去黑影层 - 去除边缘暗角
📄 装订线修复 - 仅书本模式
📄 文字增强 - USM锐化
📄 边缘锐化 - 智能锐化
📄 去噪层 - 去斑效果
📄 最终提亮 - 色阶调整
```

**调整方法**：
1. 选择图层
2. 调整不透明度（0-100%）
3. 更改混合模式
4. 添加图层蒙版进行局部调整
5. 删除不需要的效果层

### 常见问题处理

| 问题 | 原因 | 解决方法 |
|------|------|---------|
| **纸张不够白** | 白平衡不足 | 提高"白平衡调整"层不透明度 |
| **黑影仍然明显** | 强度不够 | 重新运行，选择"强力"强度 |
| **文字过度锐化** | 锐化过强 | 降低"边缘锐化"层不透明度 |
| **丢失细节** | 二值化阈值不当 | 取消"黑白二值化"选项 |
| **边缘被裁掉** | 自动裁剪过于激进 | 取消"自动裁剪"选项 |
| **装订线仍有阴影** | 书本阴影太深 | 单独提高"装订线修复"层不透明度 |
| **照片发灰** | 对比度不足 | 提高"最终提亮"层不透明度 |

---

## 🎨 高级技巧

### 1. 分层处理法

对于复杂文档，可以分步处理：

```
第一次运行：
  - 只勾选"自动白平衡"和"去除黑影"

第二次运行：
  - 勾选"增强文字"和"锐化"

第三次运行：
  - 勾选"去噪"（如果需要）
```

### 2. 手动去黑影

如果自动效果不理想：

```
1. 创建新图层
2. 使用柔边画笔工具
3. 颜色：白色
4. 不透明度：20-30%
5. 涂抹黑影区域
6. 混合模式：叠加或柔光
```

### 3. 局部增强

对于文档中的重要区域：

```
1. 选择"文字增强"图层
2. 添加图层蒙版
3. 用黑色画笔隐藏不需要的区域
4. 用白色画笔显示需要增强的区域
```

### 4. 透视矫正

如果拍摄时角度不正：

```
1. 运行脚本前先做透视矫正：
   - 选择 → 全部
   - 编辑 → 变换 → 透视/变形
   - 调整边角，使文档成为矩形
2. 然后再运行去黑影脚本
```

### 5. 拼接跨页照片

对于书本跨页：

```
方法1：Photomerge
  - 文件 → 自动 → Photomerge
  - 选择左右两页照片
  - 自动拼接

方法2：手动拼接
  - 将两页放在同一文档
  - 对齐边缘
  - 使用蒙版平滑过渡
  - 运行脚本去黑影
```

---

## 📊 处理效果对比

### 典型改善

| 问题 | 处理前 | 处理后 |
|------|--------|--------|
| 纸张偏黄 | 泛黄的纸张 | 纯白色纸张 |
| 边缘暗角 | 四周明显变暗 | 整体亮度均匀 |
| 装订阴影 | 中缝黑色阴影 | 阴影几乎消失 |
| 文字模糊 | 字迹不够清晰 | 文字清晰锐利 |
| 扫描噪点 | 表面有颗粒 | 平滑干净 |
| 对比度低 | 灰蒙蒙的 | 黑白分明 |

---

## 📁 输出建议

### 保存格式

| 用途 | 推荐格式 | 设置 |
|------|---------|------|
| **存档/编辑** | PSD | 保留所有图层 |
| **打印** | TIFF | LZW压缩，300 DPI |
| **电子文档** | PDF | 通过PDF打印机 |
| **网络分享** | JPEG | 质量：10-12 |
| **OCR识别** | PNG/TIFF | 300 DPI以上 |

### 打印设置

```
1. 文件 → 打印
2. 设置：
   - 色彩管理：由打印机管理
   - 打印分辨率：300 DPI
   - 纸张类型：根据实际选择
3. 勾选"缩放以适合介质"
```

---

## ⚠️ 注意事项

### 常见误区

❌ **错误做法**：
1. 拍摄时使用闪光灯 → 造成强烈反光
2. 斜角拍摄 → 需要透视矫正
3. 分辨率太低 → 打印模糊
4. 过度锐化 → 文字出现伪影
5. 二值化后无法恢复 → 保留原文件

✅ **正确做法**：
1. 使用柔和均匀的光线
2. 相机与文档平行
3. 至少1200px宽度的分辨率
4. 适度锐化，查看100%比例
5. 始终保留原始照片

### 兼容性

- **Photoshop版本**：CS6及更高
- **文件格式**：JPEG、PNG、TIFF、PSD
- **照片类型**：手机拍摄、扫描仪、相机拍摄
- **文档类型**：黑白、彩色均可

---

## 🔧 故障排除

| 问题 | 解决方案 |
|------|---------|
| 脚本无法运行 | 检查Photoshop版本（需CS6+） |
| 提示"请先打开照片" | 确保在Photoshop中打开了照片 |
| 处理后文件变大 | 正常现象，因为创建了多个图层 |
| 某个效果不明显 | 调整对应图层的不透明度 |
| 去黑影过度 | 降低"去黑影层"不透明度 |
| 纸张过曝 | 降低"白平衡调整"或"最终提亮"不透明度 |
| 程序崩溃 | 文件可能过大，减小尺寸或分步处理 |

---

## 📝 快捷键参考

| 操作 | Windows | Mac |
|------|---------|-----|
| 运行脚本 | 文件→脚本→浏览 | 文件→脚本→浏览 |
| 撤销 | Ctrl+Z | Cmd+Z |
| 调整不透明度 | 数字键（1-100%） | 数字键（1-100%） |
| 新建图层 | Ctrl+Shift+N | Cmd+Shift+N |
| 合并可见 | Ctrl+Shift+Alt+E | Cmd+Shift+Option+E |

---

## 📞 使用场景

### 教育场景
- 📚 拍摄课本、笔记
- 📝 复习试卷、作业
- 📖 制作电子课件
- 🖨️ 打印复习资料

### 办公场景
- 📄 合同、文档电子化
- 📋 会议记录、白板照片
- 📊 报表、图表拍摄
- 🗂️ 档案数字化

### 个人场景
- 📒 笔记整理
- 🎨 手绘作品存档
- 📸 证件复印
- 📦 收据保存

---

**祝你的文档处理更加高效！✨**

---

*创建日期：2025年*
*适用版本：Photoshop CS6/CC/2018-2025*
*脚本版本：v1.0*
